<!DOCTYPE html>
<html>
  <head>
    <title>Group 1 Project: Destination Alarm Clock: Leaflet Control Geocoder</title>

    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no initial-scale=1, maximum-scale=1"
    />



    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css" />

<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
     integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg="
     crossorigin="">
</script>

<style>
    #map {
      width: 700px;
      height: 700px;
    }
</style>


    <!-------------------------------------------------------->
    <!-- Firebase 8 Library related CSS, JS, JQuery go here -->
    <!-------------------------------------------------------->
   
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />



</head>


<body>

    <div id="map"></div>


    <div class="container">
        <h1 class="display-4">Destination Alarm Clock</h1>
        <p class="lead">Pick a location and set an alarm!</p>
        <div class="search-scope">
          <input type="range" min="100" max="1000" value="100" class="slider" id="myRange">
          <p>Radius (meters) :
            <span id="radius-goes-here">100</span>
          </p>
        </div>
    </div>
    
    <div class="container">
      <div class="click-to-map">
        <h1>Click anywhere on the map to navigate</h1>
      </div>
      <div id="message"></div>
      <div id="map"></div>
    </div>
    




    
<script>
    //----------------------------
    // Get radius from the slider
    //----------------------------
    var radius = document.getElementById("myRange").value;  //initial value
    document.getElementById("myRange").addEventListener("click", function () {
          radius = document.getElementById("myRange").value;
          //console.log(radius);
          document.getElementById("radius-goes-here").innerHTML = radius;
        
            radius.oninput = function(){
                output.innerHTML = radius.value;
                circle.setRadius(this.value);
                
            }
         
    })


    //--------------------------------------
// MAP:  get current geolocation
//---------------------------------------
navigator.geolocation.getCurrentPosition(onSuccess, onError);
var map; //for the map to be displayed
var marker; //for current location
var circle; //for destination location

    

    //------------------------
    // handle success case
    //------------------------
    function onSuccess(position) { //callback function
      const {
        latitude,
        longitude
      } = position.coords;

      //print helpful messages about current location
      message.classList.add('success');
      message.textContent = `Your location: (${latitude},${longitude})`;
      //set map to be around current location
      //set a marker at the current location
      map = L.map('map').setView([latitude, longitude], 13);
      marker = L.marker([latitude, longitude]).addTo(map);

      //put overlay on the map, give credit wher credit is due
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      //create a popup when a location is clicked
      //create a circle marker when a location is clicked
      var popup = L.popup();
      var location = new L.circle();

      //Create listener, and event handler for a click
      //"e" is the clicked location
      map.on('click', onMapClick);

      function onMapClick(e) {
        //assign content to popup message
        popup
          .setLatLng(e.latlng)
          .setContent("You clicked the map at " + e.latlng.toString())
          .openOn(map);
        //remove old layers with old circles
        //create new circle around clicked location "e"
        //add it to the  map
        map.removeLayer(location);
        location = new L.circle(e.latlng, {
          fillColor: '#f03',
          radius: radius,
        });
        map.addLayer(location);
      }
    }



        // handle error case
        function onError() {
      message.classList.add('error');
      message.textContent = `Failed to get your location!`;
    }



    // add search bar and declare it as variable



    // add to firestore
    //-----------------------------------------------
// Create a "max" number of hike document objects
//-----------------------------------------------
function writeLocationData() {
    max = 100;
    //define a variable for the collection you want to create in Firestore to populate data
    var locationRef = db.document("searched_location");
    for (i = 1; i <= max; i++) {
        locationRef.add({ //add to database, autogen ID
            name: "searched location" + i,
            details: "Your most recent search: " + i,
            last_updated: firebase.firestore.FieldValue.serverTimestamp()
        })
   }
}


</script>
</body>
